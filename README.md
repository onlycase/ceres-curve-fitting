## Curve Fitting with Ceres

Ceres is an optimizer built for solving non-linear least-squares problems -- given a set of observations, a best fitting curve must be found. The data (observations) were generated by sampling the ground truth curve and adding gaussian noise. The observations were fitted using least squares, which minimizes the sum of the squares of the residuals (offset from the curve).

## data

The data consists of 100 observations from x=0 to x=5, with y values being generated according to the curve y=exp(mx+c) with m=0.3 and c=0.1 with added gaussian noise with a standard deviation 0.2.

```cpp
double m_obs = 0.3;
double c_obs = 0.1;
int N = 100;

cv::RNG rng;
double sigma = 0.2;
std::vector<double> x_obs, y_obs;

for(int i=0; i<N; ++i) {
    double x_i = i/20;
    x_obs.push_back(x_i);
    y_obs.push_back(exp(m_obs * x_i + c_obs) + rng.gaussian(sigma));
}

```

## results

Using the Ceres solver brief report (or full report with FullReport()) as in

```cpp
ceres::Solver::Summary summary;
Solve(options, &problem, &summary);
std::cout << summary.BriefReport() << std::endl;

```

The results are

```
iter      cost      cost_change  |gradient|   |step|    tr_ratio  tr_radius  ls_iter  iter_time  total_time
   0  1.206134e+02    0.00e+00    3.75e+02   0.00e+00   0.00e+00  1.00e+04        0    8.27e-04    9.49e-04
   1  9.475925e+02   -8.27e+02    0.00e+00   6.68e-01  -7.05e+00  5.00e+03        1    8.70e-05    1.09e-03
   2  9.465905e+02   -8.26e+02    0.00e+00   6.68e-01  -7.04e+00  1.25e+03        1    1.60e-05    1.11e-03
   3  9.406153e+02   -8.20e+02    0.00e+00   6.67e-01  -6.99e+00  1.56e+02        1    1.41e-05    1.13e-03
   4  8.877182e+02   -7.67e+02    0.00e+00   6.52e-01  -6.54e+00  9.77e+00        1    1.38e-05    1.15e-03
   5  4.116816e+02   -2.91e+02    0.00e+00   5.42e-01  -2.53e+00  3.05e-01        1    1.41e-05    1.17e-03
   6  3.949799e+01    8.11e+01    4.04e+02   2.58e-01   1.31e+00  9.16e-01        1    9.07e-04    2.08e-03
   7  8.432961e+00    3.11e+01    1.84e+02   1.30e-01   1.11e+00  2.75e+00        1    9.24e-04    3.04e-03
   8  4.559932e+00    3.87e+00    5.72e+01   3.86e-02   1.03e+00  8.24e+00        1    9.74e-04    4.03e-03
   9  2.929452e+00    1.63e+00    2.26e+01   9.11e-02   9.89e-01  2.47e+01        1    1.12e-03    5.17e-03
  10  2.163886e+00    7.66e-01    7.06e+00   9.60e-02   9.87e-01  7.42e+01        1    9.26e-04    6.11e-03
  11  2.047748e+00    1.16e-01    1.09e+00   4.85e-02   9.95e-01  2.22e+02        1    8.03e-04    6.93e-03
  12  2.043951e+00    3.80e-03    7.28e-02   1.00e-02   9.98e-01  6.67e+02        1    9.15e-04    7.86e-03
  13  2.043934e+00    1.74e-05    1.59e-03   7.14e-04   9.98e-01  2.00e+03        1    8.85e-04    8.77e-03
Ceres Solver Report: Iterations: 14, Initial cost: 1.206134e+02, Final cost: 2.043934e+00, Termination: CONVERGENCE
Initial m: 0 c: 0
Final m: 0.309675 c: 0.0815717
```

Starting with initial values of m and c as 0, after 14 iterations they converged to m=0.31 and c=0.08. This is pretty close to the ground truth of m=0.3 and c=0.1.

The figure below shows the data plotted. This data was written to `ceres-output.txt` in the `build/` directory since I'm having trouble suppressing the Ceres output. The python script `main.py` reads the file and plots the data with matplotlib.

<p align="center"><img src="https://raw.githubusercontent.com/onlycase/ceres-curve-fitting/master/assets/ceres-output.png"/></p>


## requirements

* ceres
* opencv
* matplotlib

## to do

* robust curve fitting

## to run

its a little janky atm with the directories but it works.

```
./run.sh
```


## links
* http://ceres-solver.org/nnls_tutorial.html
* https://mathworld.wolfram.com/LeastSquaresFitting.html
* https://mathworld.wolfram.com/NonlinearLeastSquaresFitting.html
